from groq import Groq
import os
 

def summarize_text(input_text):
    """
    Sends a Hebrew conversation to the Groq API for summarization and returns the summary.

    Args:
        input_text (str): The conversation text in Hebrew to be summarized.

    Returns:
        str: The summary provided by the Groq API.
    """
    client = Groq(api_key= os.getenv("GROQ_API_KEY"))

    # Prepare the request
    completion = client.chat.completions.create(
        model="llama-3.3-70b-versatile",
        messages=[
            {
                "role": "system",
                "content": (
                    "  בתור מסכם טקסטים מוסמך של המ  סכם לי את הטקסט הבא בצורה תמציתית ומדוייקת ושים דגש על משפטים שקיים חשד לפעילות פלילית בהם"  ),
            },
            {"role": "user", "content": input_text},
        ],
        temperature=0,
        max_tokens=1024,
        top_p=1,
        stream=True,
        stop=None,
    )

    # Collect the response
    summary = ""
    for chunk in completion:
        if chunk.choices[0].delta.content:
            summary += chunk.choices[0].delta.content

    return summary

# Example usage
if __name__ == "__main__":
    input_text = (
        """
        {
            די נידארנו (050-1234567):
	"הי, חברים. המצב לא פשוט. הלקוחות שמתחילים לקבל את אישורי ההטמנה שואלים שאלות. הם לא רגילים למקרים כאלה, וזה מתחיל להיראות חשוד. אבו עלי, מה קורה עם העברות הכספים?"
	
	אבו עלי אקספרס (050-2345678):
	"אני כבר מתחיל לאסוף את הצ'יקים, הכל מתואם עם פישיפח. השאלות מגיעות בעיקר בגלל שהסכומים לא כל כך מסתדרים עם שאר החשבוניות. חייבים למצוא דרך להסתיר את המקורות."
	
	דקה קומוסטס (050-3456789):
	"אני יודע. אז אני משדרג את השיטות בינתיים עם בי אס טורנדו וביגשי. צריך לדאוג שהכסף יעבור דרך החברה הפרטית ב'בי אס טורנדו', ואז להמיר את הצ'יקים ב'ביגשי'. אם לא נעשה את זה, יתחילו לחפור."
	
	די נידארנו:
	"נכון, אנחנו לא רוצים למשוך תשומת לב. אם יתחילו לשאול שאלות על פישיפח ו'קישקיש', זה יכול להיות הסוף של העסק הזה."
	
	אבו עלי אקספרס:
	"אני אשלח את הצ'יקים לפישיפח, ואנחנו נעשה את כל המעברים דרך 'קישקיש' ו'בוקי סרקי', זה כבר מזמן לא מעניין אף אחד. אבל די נידארנו, אתה בטח יודע שהלקוחות לא יכולים לדעת מה קורה באמת. אז צריך להראות להם שההטמנות היו חוקיות ושהם קיבלו בדיוק את מה שהם שילמו עליו."
	
	דקה קומוסטס:
	"אתם צודקים, המטרה היא לא למשוך תשומת לב. בינתיים, אני מתחיל לסדר את החשבוניות שמגיעות מ'פינוי ודישדוש' ו'עפר סולו'. אם מישהו יבדוק את כל השמות שמגיעים משם, הם יראו שהכול בסדר."
	
	די נידארנו:
	"ואנחנו לא שוכחים את 'הירוק' ו'הכחול', נכון? הם יכולים להפעיל את הלחץ על החברה לפינוי פסולת ולחפירות עפר, ככה זה ייראה יותר טבעי."
	
	אבו עלי אקספרס:
	"כן, בדיוק. נוודא שלא ייווצר קשר ישיר בין השמות של החברות הקש וההעברות. אני מקווה שזה יעבוד, כי אם לא, יש לנו בעיה."
	
	דקה קומוסטס:
	"אני לא לוקח סיכון, אני אתעקש על כמה שיותר צ'קים גדולים מ'קושקוש כלום ושום דבר', כדי שזה לא ייראה חשוד."
	
	די נידארנו:
	"מעולה. אז קדימה, נעבוד בצורה שקטה. כל הצ'יקים צריכים לעבור דרך התהליך הזה – מעסק לעסק – ואז נוכל להוציא את הכסף הלאה. נשאר רק לוודא שהכספים שהעברנו בפיצול לא יתפסו על ידי הרשויות."
	
	אבו עלי אקספרס:
	"אני מתחיל להעביר את הצ'יקים הבאים לכיוון 'פישיפח' ו'קישקיש'. הצ'קים של 'קושקוש' בדרך."
	
	דקה קומוסטס:
	"מעולה. אני אעדכן אתכם כל הזמן. אנחנו לא רוצים שום טעויות, הסכום הזה חייב לעבור חלק."
	
	די נידארנו:
	"מצוין. חברים, אם מישהו שואל שאלות, תדאגו לתשובות טובות. אני לא רוצה שתהיה לנו בעיה עם החברות הנורמטיביות. לא שווה לנו להסתבך על שטויות."
	
	אבו עלי אקספרס:
	"ברור. רק לא לשכוח את הלקוח מ'הירוק' שמרוצה מהפינוי."


}
  """
    )

    summary = summarize_text(input_text)
    print("Summary:", summary)
